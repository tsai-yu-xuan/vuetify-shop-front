import{a6 as B,u as A,E as h,c as x,o as p,a as _,b as a,w as s,ac as i,R as r,ab as m,ad as f,aM as D,az as I}from"./index-D7n94ywy.js";import{V as k}from"./VCol-CWCnw2cO.js";import{V as N}from"./VDivider-BKhsb_Eu.js";import{V as P}from"./VDataTable-Ay2jjMJA.js";import{V as S}from"./VContainer-BmQjg5-A.js";import"./VPagination-ii_jkyHy.js";import"./VList-CsSy4_p1.js";const $={class:"bg"},E=f("h1",{class:"text-center"},"購物車",-1),R={key:0},T={key:1,class:"text-red"},L={__name:"cart",setup(z){const{apiAuth:C}=I(),v=D(),d=B(),c=A(),o=h([]),b=[{title:"品名",key:"p_id.name"},{title:"單價",key:"p_id.price"},{title:"數量",key:"quantity"},{title:"總價",key:"total",value:t=>t.p_id.price*t.quantity},{title:"操作",key:"action"}];(async()=>{var t,l;try{const{data:e}=await C.get("/user/cart");o.value=e.result}catch(e){console.log(e),d({text:((l=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const g=x(()=>o.value.reduce((t,l)=>t+l.quantity*l.p_id.price,0)),V=x(()=>o.value.length>0&&!o.value.some(t=>!t.p_id.sell)),y=h(!1),q=async()=>{y.value=!0;const t=await c.checkout();d({text:t.text,snackbarProps:{color:t.color}}),t.color==="green"&&(c.isAdmin?(console.log(c),v.push("/admin/orders")):v.push("/user/orders")),y.value=!1},u=async(t,l)=>{const e=await c.addCart(t,l);if(d({text:e.text,snackbarProps:{color:e.color}}),e.color==="green"){const n=o.value.findIndex(w=>w.p_id._id===t);o.value[n].quantity+=l,o.value[n].quantity<=0&&o.value.splice(n,1)}};return(t,l)=>(p(),_("div",$,[a(S,null,{default:s(()=>[a(k,{cols:"12",class:"title"},{default:s(()=>[E]),_:1}),a(N),a(k,{cols:"12"},{default:s(()=>[a(P,{items:o.value,headers:b,class:"tableBg"},{"item.p_id.name":s(({item:e})=>[e.p_id.sell?(p(),_("span",R,i(e.p_id.name),1)):(p(),_("span",T,i(e.p_id.name)+" (已下架)",1))]),"item.quantity":s(({item:e})=>[a(r,{variant:"text",color:"red",onClick:n=>u(e.p_id._id,-1)},{default:s(()=>[m("-")]),_:2},1032,["onClick"]),f("span",null,i(e.quantity),1),a(r,{variant:"text",color:"green",onClick:n=>u(e.p_id._id,1)},{default:s(()=>[m("+")]),_:2},1032,["onClick"])]),"item.action":s(({item:e})=>[a(r,{variant:"text",color:"red",icon:"mdi-delete",onClick:n=>u(e.p_id._id,e.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),a(k,{cols:"12",class:"text-center"},{default:s(()=>[f("p",null,"總金額: "+i(g.value),1),a(r,{class:"btn",disabled:!V.value,onClick:q},{default:s(()=>[m("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1})]))}};export{L as default};
