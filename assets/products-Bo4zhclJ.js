import{p as ne,aE as be,aF as we,g as se,L as Ve,aG as ye,aH as ke,c as E,h as re,aI as xe,aJ as ee,b as l,O as G,t as z,av as Se,A as Ce,F as O,aK as Fe,aL as Ie,E as p,z as De,P as Te,I as Be,H as K,J as Re,aM as Ae,aN as Ue,a1 as ie,aO as Me,aP as He,aQ as Ne,aR as Ee,at as ae,aS as Ge,C as $e,G as _e,_ as ze,a6 as Le,r as Oe,o as de,a as qe,w as f,aT as je,aD as Ke,R as Y,ac as Z,aU as te,aV as Je,V as We,a8 as Qe,a9 as Xe,aW as Ye,d as v,ay as Ze,aA as ea,ae as aa,aC as ta,aX as la,a3 as oa,af as na,ag as sa,aa as ra}from"./index-oGRGZSga.js";import{c as ua,a as le,b as ia,d as da,u as ca,e as J,V as va}from"./vee-validate.esm-CNgcKS4X.js";import{b as ce}from"./route-block-B_A1xBdJ.js";import{V as ma,a as oe}from"./VCol-DNN6IRs-.js";import{V as fa}from"./VRow-C7uSkosZ.js";import{m as ga,a as ve,b as pa,c as ba,d as Va,e as ya,f as xa,g as ha,h as Pa,u as wa,p as ka,i as Sa,j as Ca,k as Fa,l as Ia,n as Da,o as Ta,q as me,r as fe,s as ge,t as pe,v as Ba}from"./VDataTable-C90plVBM.js";import{V as Ra}from"./VDivider-BgLPiVty.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./VPagination-jhmSDHkA.js";import"./VList-C_Op3pnQ.js";const Aa=ne({...be(),...we(ga(),["inline"])},"VCheckbox"),Ua=se()({name:"VCheckbox",inheritAttrs:!1,props:Aa(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,D){let{attrs:k,slots:o}=D;const s=Ve(e,"modelValue"),{isFocused:d,focus:P,blur:U}=ye(e),C=ke(),T=E(()=>e.id||`checkbox-${C}`);return re(()=>{const[B,M]=xe(k),S=ee.filterProps(e),g=ve.filterProps(e);return l(ee,G({class:["v-checkbox",e.class]},B,S,{modelValue:s.value,"onUpdate:modelValue":b=>s.value=b,id:T.value,focused:d.value,style:e.style}),{...o,default:b=>{let{id:y,messagesId:F,isDisabled:V,isReadonly:H,isValid:$}=b;return l(ve,G(g,{id:y.value,"aria-describedby":F.value,disabled:V.value,readonly:H.value},M,{error:$.value===!1,modelValue:s.value,"onUpdate:modelValue":R=>s.value=R,onFocus:P,onBlur:U}),o)}})}),{}}}),Ma=ne({itemsLength:{type:[Number,String],required:!0},...pa(),...ba(),...Va()},"VDataTableServer"),Ha=se()({name:"VDataTableServer",props:Ma(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,D){let{attrs:k,slots:o}=D;const{groupBy:s}=ya(e),{sortBy:d,multiSort:P,mustSort:U}=xa(e),{page:C,itemsPerPage:T}=ha(e),B=E(()=>parseInt(e.itemsLength,10)),{columns:M,headers:S}=Pa(e,{groupBy:s,showSelect:z(e,"showSelect"),showExpand:z(e,"showExpand")}),{items:g}=wa(e,M),{toggleSort:b}=ka({sortBy:d,multiSort:P,mustSort:U,page:C}),{opened:y,isGroupOpen:F,toggleGroup:V,extractRows:H}=Sa({groupBy:s,sortBy:d}),{pageCount:$,setItemsPerPage:R}=Ca({page:C,itemsPerPage:T,itemsLength:B}),{flatItems:A}=Fa(g,s,y),{isSelected:x,select:I,selectAll:_,toggleSelect:w,someSelected:h,allSelected:r}=Ia(e,{allItems:g,currentPage:g}),{isExpanded:c,toggleExpand:n}=Da(e),a=E(()=>H(g.value));Ta({page:C,itemsPerPage:T,sortBy:d,groupBy:s,search:z(e,"search")}),Se("v-data-table",{toggleSort:b,sortBy:d}),Ce({VDataTableRows:{hideNoData:z(e,"hideNoData"),noDataText:z(e,"noDataText"),loading:z(e,"loading"),loadingText:z(e,"loadingText")}});const u=E(()=>({page:C.value,itemsPerPage:T.value,sortBy:d.value,pageCount:$.value,toggleSort:b,setItemsPerPage:R,someSelected:h.value,allSelected:r.value,isSelected:x,select:I,selectAll:_,toggleSelect:w,isExpanded:c,toggleExpand:n,isGroupOpen:F,toggleGroup:V,items:a.value.map(t=>t.raw),internalItems:a.value,groupedItems:A.value,columns:M.value,headers:S.value}));re(()=>{const t=me.filterProps(e),i=fe.filterProps(e),m=ge.filterProps(e),L=pe.filterProps(e);return l(pe,G({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},L),{top:()=>{var N;return(N=o.top)==null?void 0:N.call(o,u.value)},default:()=>{var N,q,W,Q,X,j;return o.default?o.default(u.value):l(O,null,[(N=o.colgroup)==null?void 0:N.call(o,u.value),!e.hideDefaultHeader&&l("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[l(fe,G(i,{sticky:e.fixedHeader}),o)]),(q=o.thead)==null?void 0:q.call(o,u.value),!e.hideDefaultBody&&l("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(W=o["body.prepend"])==null?void 0:W.call(o,u.value),o.body?o.body(u.value):l(ge,G(k,m,{items:A.value}),o),(Q=o["body.append"])==null?void 0:Q.call(o,u.value)]),(X=o.tbody)==null?void 0:X.call(o,u.value),(j=o.tfoot)==null?void 0:j.call(o,u.value)])},bottom:()=>o.bottom?o.bottom(u.value):!e.hideDefaultFooter&&l(O,null,[l(Ra,null,null),l(me,t,{prepend:o["footer.prepend"]})])})})}}),Na=ne({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...be(),...Fe()},"VTextarea"),Ea=se()({name:"VTextarea",directives:{Intersect:Ie},inheritAttrs:!1,props:Na(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,D){let{attrs:k,emit:o,slots:s}=D;const d=Ve(e,"modelValue"),{isFocused:P,focus:U,blur:C}=ye(e),T=E(()=>typeof e.counterValue=="function"?e.counterValue(d.value):(d.value||"").toString().length),B=E(()=>{if(k.maxlength)return k.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function M(r,c){var n,a;!e.autofocus||!r||(a=(n=c[0].target)==null?void 0:n.focus)==null||a.call(n)}const S=p(),g=p(),b=De(""),y=p(),F=E(()=>e.persistentPlaceholder||P.value||e.active);function V(){var r;y.value!==document.activeElement&&((r=y.value)==null||r.focus()),P.value||U()}function H(r){V(),o("click:control",r)}function $(r){o("mousedown:control",r)}function R(r){r.stopPropagation(),V(),ae(()=>{d.value="",Ge(e["onClick:clear"],r)})}function A(r){var n;const c=r.target;if(d.value=c.value,(n=e.modelModifiers)!=null&&n.trim){const a=[c.selectionStart,c.selectionEnd];ae(()=>{c.selectionStart=a[0],c.selectionEnd=a[1]})}}const x=p(),I=p(+e.rows),_=E(()=>["plain","underlined"].includes(e.variant));Te(()=>{e.autoGrow||(I.value=+e.rows)});function w(){e.autoGrow&&ae(()=>{if(!x.value||!g.value)return;const r=getComputedStyle(x.value),c=getComputedStyle(g.value.$el),n=parseFloat(r.getPropertyValue("--v-field-padding-top"))+parseFloat(r.getPropertyValue("--v-input-padding-top"))+parseFloat(r.getPropertyValue("--v-field-padding-bottom")),a=x.value.scrollHeight,u=parseFloat(r.lineHeight),t=Math.max(parseFloat(e.rows)*u+n,parseFloat(c.getPropertyValue("--v-input-control-height"))),i=parseFloat(e.maxRows)*u+n||1/0,m=_e(a??0,t,i);I.value=Math.floor((m-n)/u),b.value=$e(m)})}Be(w),K(d,w),K(()=>e.rows,w),K(()=>e.maxRows,w),K(()=>e.density,w);let h;return K(x,r=>{r?(h=new ResizeObserver(w),h.observe(x.value)):h==null||h.disconnect()}),Re(()=>{h==null||h.disconnect()}),re(()=>{const r=!!(s.counter||e.counter||e.counterValue),c=!!(r||s.details),[n,a]=xe(k),{modelValue:u,...t}=ee.filterProps(e),i=Ae(e);return l(ee,G({ref:S,modelValue:d.value,"onUpdate:modelValue":m=>d.value=m,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":_.value},e.class],style:e.style},n,t,{centerAffix:I.value===1&&!_.value,focused:P.value}),{...s,default:m=>{let{id:L,isDisabled:N,isDirty:q,isReadonly:W,isValid:Q}=m;return l(Ue,G({ref:g,style:{"--v-textarea-control-height":b.value},onClick:H,onMousedown:$,"onClick:clear":R,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},i,{id:L.value,active:F.value||q.value,centerAffix:I.value===1&&!_.value,dirty:q.value||e.dirty,disabled:N.value,focused:P.value,error:Q.value===!1}),{...s,default:X=>{let{props:{class:j,...ue}}=X;return l(O,null,[e.prefix&&l("span",{class:"v-text-field__prefix"},[e.prefix]),ie(l("textarea",G({ref:y,class:j,value:d.value,onInput:A,autofocus:e.autofocus,readonly:W.value,disabled:N.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:V,onBlur:C},ue,a),null),[[Me("intersect"),{handler:M},null,{once:!0}]]),e.autoGrow&&ie(l("textarea",{class:[j,"v-textarea__sizer"],id:`${ue.id}-sizer`,"onUpdate:modelValue":Pe=>d.value=Pe,ref:x,readonly:!0,"aria-hidden":"true"},null),[[He,d.value]]),e.suffix&&l("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:c?m=>{var L;return l(O,null,[(L=s.details)==null?void 0:L.call(s,m),r&&l(O,null,[l("span",null,null),l(Ne,{active:e.persistentCounter||P.value,value:T.value,max:B.value,disabled:e.disabled},s.counter)])])}:void 0})}),Ee({},S,g,y)}}),Ga=e=>(na("data-v-19d5c658"),e=e(),sa(),e),$a=Ga(()=>ra("h1",{class:"text-center text-white"},"商品管理",-1)),he={__name:"products",setup(e){const{apiAuth:D}=Ke(),k=Le(),o=p(null),s=p({open:!1,id:""}),d=n=>{n?(s.value.id=n._id,S.value.value=n.name,g.value.value=n.price,b.value.value=n.description,y.value.value=n.category,F.value.value=n.sell):s.value.id="",s.value.open=!0},P=()=>{s.value.open=!1,M(),o.value.deleteFileRecord()},U=["衣服","手機","遊戲","食品"],C=ua({name:le().required("商品名稱必填"),price:ia().typeError("商品價格格式錯誤").required("商品價格必填").min(0,"商品價格不能小於 0"),description:le().required("商品說明必填"),category:le().required("商品分類必填").test("isCategory","商品分類錯誤",n=>U.includes(n)),sell:da()}),{handleSubmit:T,isSubmitting:B,resetForm:M}=ca({validationSchema:C,initialValues:{name:"",price:0,description:"",category:"",sell:!0}}),S=J("name"),g=J("price"),b=J("description"),y=J("category"),F=J("sell"),V=p([]),H=p([]),$=T(async n=>{var a,u,t;if(!((a=V.value[0])!=null&&a.error)&&!(s.value.id.length===0&&V.value.length<1))try{const i=new FormData;i.append("name",n.name),i.append("price",n.price),i.append("description",n.description),i.append("category",n.category),i.append("sell",n.sell),V.value.length>0&&i.append("image",V.value[0].file),s.value.id===""?await D.post("/product",i):await D.patch("/product/"+s.value.id,i),k({text:s.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),P(),c(!0)}catch(i){console.log(i),k({text:((t=(u=i==null?void 0:i.response)==null?void 0:u.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),R=p(10),A=p([{key:"createdAt",order:"desc"}]),x=p(1),I=p([]),_=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"操作",align:"center",sortable:!1,key:"action"}],w=p(!0),h=p(0),r=p(""),c=async n=>{var a,u,t,i;n&&(x.value=1),w.value=!0;try{const{data:m}=await D.get("/product/all",{params:{page:x.value,itemsPerPage:R.value,sortBy:((a=A.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((u=A.value[0])==null?void 0:u.order)||"desc",search:r.value}});I.value.splice(0,I.value.length,...m.result.data),h.value=m.result.total}catch(m){console.log(m),k({text:((i=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:i.message)||"發生錯誤",snackbarProps:{color:"red"}})}w.value=!1};return c(),(n,a)=>{const u=Oe("vue-file-agent");return de(),qe(O,null,[l(ma,{class:"bg"},{default:f(()=>[l(fa,null,{default:f(()=>[l(oe,{cols:"12"},{default:f(()=>[$a]),_:1}),l(oe,{cols:"12"},{default:f(()=>[l(Y,{color:"green",onClick:a[0]||(a[0]=t=>d(null))},{default:f(()=>[Z("新增商品")]),_:1})]),_:1}),l(oe,{cols:"12"},{default:f(()=>[l(Ha,{"items-per-page":R.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=t=>R.value=t),a[7]||(a[7]=t=>c(!1))],"sort-by":A.value,"onUpdate:sortBy":[a[5]||(a[5]=t=>A.value=t),a[8]||(a[8]=t=>c(!1))],page:x.value,"onUpdate:page":[a[6]||(a[6]=t=>x.value=t),a[9]||(a[9]=t=>c(!1))],items:I.value,headers:_,loading:w.value,"items-length":h.value,search:r.value,hover:""},{top:f(()=>[l(te,{label:"搜尋",modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=t=>r.value=t),"append-icon":"mdi-magnify",onClickAppend:a[2]||(a[2]=t=>c(!0)),onKeydown:a[3]||(a[3]=Je(t=>c(!0),["enter"]))},null,8,["modelValue"])]),"item.image":f(({value:t})=>[l(We,{src:t,height:"50px"},null,8,["src"])]),"item.sell":f(({value:t})=>[t?(de(),Qe(oa,{key:0,icon:"mdi-check"})):Xe("",!0)]),"item.action":f(({item:t})=>[l(Y,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:i=>d(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(je,{modelValue:s.value.open,"onUpdate:modelValue":a[17]||(a[17]=t=>s.value.open=t),persistent:"",width:"500"},{default:f(()=>[l(va,{onSubmit:Ye(v($),["prevent"]),disabled:v(B)},{default:f(()=>[l(Ze,null,{default:f(()=>[l(ea,null,{default:f(()=>[Z(aa(s.value.id?"編輯商品":"新增商品"),1)]),_:1}),l(ta,null,{default:f(()=>[l(te,{label:"名稱",modelValue:v(S).value.value,"onUpdate:modelValue":a[10]||(a[10]=t=>v(S).value.value=t),"error-messages":v(S).errorMessage.value},null,8,["modelValue","error-messages"]),l(te,{label:"價格",type:"number",min:"0",modelValue:v(g).value.value,"onUpdate:modelValue":a[11]||(a[11]=t=>v(g).value.value=t),"error-messages":v(g).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ba,{label:"分類",items:U,modelValue:v(y).value.value,"onUpdate:modelValue":a[12]||(a[12]=t=>v(y).value.value=t),"error-messages":v(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ua,{label:"上架",modelValue:v(F).value.value,"onUpdate:modelValue":a[13]||(a[13]=t=>v(F).value.value=t),"error-messages":v(F).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ea,{label:"說明",modelValue:v(b).value.value,"onUpdate:modelValue":a[14]||(a[14]=t=>v(b).value.value=t),"error-messages":v(b).errorMessage.value},null,8,["modelValue","error-messages"]),l(u,{modelValue:V.value,"onUpdate:modelValue":a[15]||(a[15]=t=>V.value=t),"raw-model-value":H.value,"onUpdate:rawModelValue":a[16]||(a[16]=t=>H.value=t),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:o},null,8,["modelValue","raw-model-value"])]),_:1}),l(la,null,{default:f(()=>[l(Y,{color:"red",loading:v(B),onClick:P},{default:f(()=>[Z("取消")]),_:1},8,["loading"]),l(Y,{color:"green",type:"submit",loading:v(B)},{default:f(()=>[Z("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof ce=="function"&&ce(he);const Xa=ze(he,[["__scopeId","data-v-19d5c658"]]);export{Xa as default};
